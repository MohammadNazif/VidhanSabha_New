@model IEnumerable<VishanSabha.Models.Sector>


@{
    ViewBag.Title = "Sector";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var CategoryList = ViewData["CategoryList"] as List<VishanSabha.Models.Caste>;
}


<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />


<style>
    body {
        background-color: #fdfaf6;
        font-family: 'Poppins', sans-serif;
    }

    .table-head {
        background-color: #FF8C42;
        color: white !important;
        /*        display:none;*/
    }

    .myhead {
        font-size: 12px;
        color: white;
        padding: 15px 10px;
    }

    .table-head th, #myTable td {
        text-align: left !important;
        vertical-align: middle;
        padding: 2px 6px;
        font-size: 11px;
    }

    #myTable img {
        width: 50px !important;
        height: auto;
    }

    /*.table-responsive {
        overflow-x: auto;
        white-space: nowrap;
        max-height: 80vh !important;
    }*/

    #myTable td,
    #myTable th {
        white-space: nowrap;
        padding: 3px 6px !important; /* kam padding → row height kam */
        font-size: 11px !important; /* chhota text */
        line-height: 1.2 !important; /* compact vertical spacing */
        height: 26px !important;
    }

    #myTable th {
        color: white !important;
    }

    .btn-outline-orange {
        border-color: orange;
        color: orange;
        font-size: 12px;
        padding: 4px 10px;
    }

        .btn-outline-orange:hover {
            background-color: #FF8C42;
            color: white;
        }

    .btn-xs {
        padding: 1px 5px;
        font-size: 8px;
        line-height: 1.2;
        border-radius: 3px;
    }

    .edit-icon, .delete-icon {
        font-size: 14px;
    }

    .edit-icon {
        color: green;
    }

    .edit-btn:hover .edit-icon {
        color: white;
    }

    .delete-icon {
        color: red;
    }

    .delete-btn:hover .delete-icon {
        color: white;
    }

    .btn-sm {
        padding: 2px 6px;
        font-size: 12px;
    }

    .dataTables_length select {
        font-size: 12px !important;
        padding: 2px 5px !important;
        width: 54px !important;
        height: 28px !important;
    }

    .dataTables_filter input {
        font-size: 12px !important;
        padding: 3px 6px !important;
        width: 150px !important;
        height: 28px !important;
        border-radius: 4px;
    }

    div.dataTables_filter input[type="search"] {
        border: 1px solid #FF8C42 !important;
    }

    #myTable_paginate .paginate_button {
        font-size: 12px; /* font size chhota ya bada karne ke liye */
        margin-top: 10px;
        padding: 5px 10px; /* button ke andar ki padding */
        min-width: 40px; /* button ki minimum width */
        height: 20px; /* button ki height */
        border-radius: 5px; /* corners round karne ke liye */
        margin: 0 2px; /* buttons ke beech thodi gap */
        cursor: pointer;
        background-color: #FF8C42;
        color: black;
        border: none;
    }

    #exportIcons a {
        text-decoration: none;
    }


    .table-wrapper {
        margin-top: 10px; /* 👈 filter section ke neeche gap */
        background: #ffffff;
        border-radius: 8px;
        padding: 10px 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }




    .table-controls {
        position: sticky;
        top: 0;
        z-index: 15;
        background: #fff;
        /*        padding: 8px 0;*/
        border-bottom: 1px solid #ddd;
    }

    .table-scroll {
        max-height: 400px; /* adjust height */
        overflow-y: auto;
        overflow-x: auto;
        position: relative;
        overflow: auto;
        z-index: 1;
        /*        padding-top:80px;*/
    }

        .table-scroll table {
            width: 100%;
            border-collapse: collapse;
        }

        /* Sticky header */
        /*.table-scroll thead th {*/
        /*            position: sticky !important;*/
        /*top: 0;
            background-color: #FF8C42;
            color: white;
            z-index: 10;
            box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
        }*/

        .table-scroll::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }

        .table-scroll::-webkit-scrollbar-thumb {
            background-color: #a4a4a4;
            border-radius: 4px;
        }

    .table-responsive {
        max-height: 400px; /* scroll area height */
        overflow-y: auto;
    }

    .select2-container {
        z-index: 99999 !important;
    }

    .select2-dropdown {
        z-index: 999999 !important;
    }

    .container-fluid {
        background: #ffffff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        margin-top: 45px !important; /* 👈 Header ke niche thoda extra space */
        position: relative;
        z-index: 1;
    }

    .dataTables_length label {
        font-size: 13px;
        font-weight: 500;
        color: #333;
        margin-right: 6px; /* 👈 "Show" aur dropdown ke beech gap */
        letter-spacing: 0.5px; /* 👈 thoda wide look */
    }

    div.dataTables_filter input[type="search"] {
        border: 1px solid #FF8C42 !important; /* Default border */
        outline: none !important; /* Default blue outline hatayega */
        box-shadow: none !important; /* Shadow remove karega */
    }

        div.dataTables_filter input[type="search"]:focus {
            border: 1px solid #FF8C42 !important; /* 👈 Focus hone par bhi same border */
            outline: none !important;
            box-shadow: none !important;
        }

    .divSize {
        width: 150px !important;
    }

    .dataTables_length select {
        font-size: 12px !important;
        padding: 2px 5px !important;
        width: 54px !important;
        height: 28px !important;
    }

    .dataTables_filter input {
        font-size: 12px !important;
        padding: 3px 6px !important;
        width: 150px !important;
        height: 28px !important;
        border-radius: 4px;
    }

    .table-wrapper {
        height: 530px !important;
        overflow: hidden;
        background: #ffffff;
        border-radius: 8px;
        padding: 10px 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
    }

    #entriesAndExport {
        position: absolute;
        top: 20px !important;
        left: 230px !important;
        background: white;
        z-index: 10;
    }
    /*    .dt-layout-row:first-child {
        position: fixed !important;
        top: 0px;
        left: 0;
        width: 100%;
        z-index: 100;
        background: white;
    }*/

    .dt-scroll-body .myhead {
        display: none !important;
    }

    .dt-scroll-body tbody td {
        min-width: 100px !important;
    }


    #myTable th:nth-child(1),
    #myTable td:nth-child(1) {
        width: 80px !important;
        max-width: 80px !important;
        min-width: 80px !important;
        text-align: center;
        white-space: nowrap;
    }
    #myTable th,
    #myTable td {
        white-space: nowrap !important;
    }

    #myTable {
        width: 100% !important;
    }

    .dataTables_scrollHeadInner,
    .dataTables_scrollHeadInner table {
        width: 100% !important;
    }

</style>



<div class="container-fluid mt-5 m-3">
    <div class="d-flex justify-content-between mb-2">
        <h3 style="color: #FF8C42;">Sector Management</h3>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createSectorModal">Create</button>
    </div>

    <div class="table-wrapper shadow rounded p-2">
        <div class="table-controls ">
            <div id="entriesAndExport"></div>
            <div id="searchBox"></div>
        </div>
        <div class="  " style="white-space:nowrap!important;">

            <table id="myTable" class="table table-responsive-lg table-hover table-bordered align-middle">


                <thead class="table-head">
                    <tr class="myhead">
                        <th class="text-white py-2 fw-bold" style="min-width:5px!important">S.N.</th>
                        <th class="text-white py-2 fw-bold">Mandal</th>
                        <th class="text-white py-2 fw-bold">Village</th>
                        @*<th class="text-white py-2 fw-bold">Sector Number</th>*@
                        <th class="text-white py-2 fw-bold">Sector Name</th>
                        <th class="text-white py-2 fw-bold">Sector Sanyojak</th>
                        <th class="text-white py-2 fw-bold">Phone Number</th>
                        @*<th class="text-white py-2 fw-bold">Caste</th>*@
                        <th class="text-white py-2 fw-bold">ProfileImage</th>

                        <th class="text-white">Actions</th>
                    </tr>
                </thead>
                <tbody class="text-start">
                    @{
                        int i = 1;
                    }

                    @foreach (var data in Model)
                    {

                        <tr class="text-start" id="row_@data.Id">
                            <td style="text-align:center!important;min-width:5px!important">@i</td>
                            <td>@data.MandalName</td>

                            <td>
                                @foreach (var village in data.VillageNames)
                                {
                                    @($"{village},")<br />
                                }
                            </td>


                            @*<td class="py-2" style="text-align:center!important;">@data.SectorNo</td>*@
                            <td>@data.SectorName</td>
                            <td>@data.InchargeName</td>
                            <td>@data.PhoneNumber</td>
                            @*<td class="py-2">@data.subcaste</td>*@


                            <td>
                                @if (!string.IsNullOrEmpty(data.ProfileImage))
                                {
                                    <img src="@Url.Content(data.ProfileImage)" class="img-thumbnail"
                                         style="max-width:50px; max-height:50px;" />
                                }
                                else
                                {
                                    <span>No Image</span>
                                }
                            </td>
                            <td>
                                <!-- Edit button -->

                                <button type="button"
                                        class="btn btn-sm  me-1 edit-btn"
                                        data-id="@data.Id">
                                    <i class="fas fa-edit text-success"></i>
                                </button>


                                <!-- Delete button -->

                                <button type="button"
                                        class="btn btn-sm  me-1 delete-btn"
                                        data-id="@data.Id">
                                    <i class="fas fa-trash-alt delete-icon"></i>
                                </button>

                            </td>
                        </tr>
                        i++;
                    }

                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="createSectorModal" tabindex="-1" aria-labelledby="createSectorLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="mysectorform" enctype="multipart/form-data">
                <input type="hidden" id="Id" name="Id" />
                <div class="modal-header table-head ">
                    <h5 class="modal-title text-white text-center fw-bold" id="createSectorLabel">Create New Sector</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body row g-2">


                    <!-- Mandal -->
                    <div class="col-md-6">
                        <label>Mandal</label>
                        <select class="form-select" name="Mandal_Id" id="mandalDropdown">
                            <option disabled selected>Loading mandals...</option>
                        </select>
                    </div>


                    <div class="col-md-6">
                        <label>Village</label>
                        <select class="form-select js-example-basic-multiple" name="Village" id="Village" multiple="multiple">
                            @*<option disabled >Loading Village...</option>*@
                        </select>
                    </div>


                    <!-- Sector Number -->
                    @*<div class="col-md-6">
                            <label>Sector Number</label>
                            <input type="text" class="form-control" id="SectorNo" name="SectorNo" placeholder="Enter sector number (e.g., 12)">
                        </div>*@

                    <!-- Sector Name -->
                    <div class="col-md-6">
                        <label>Sector Name</label>
                        <input type="text" class="form-control" id="SectorName" name="SectorName" placeholder="Enter sector name (e.g., North Zone)">
                    </div>

                    <!-- Sector Sanyojak (0/1) -->
                    <div class="col-md-6">
                        <label>Sector Sanyojak?</label>
                        <select id="SectorInchargeDropdown" class="form-select modal-incharge-select" name="SectorInchargeName">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>

                    <!-- Additional Fields (Initially Hidden) -->
                    <div class="modal-additional d-none row g-2">

                        <div class="col-md-4">
                            <label>InchargeName</label>
                            <input type="text" class="form-control" id="InchargeName" name="InchargeName" placeholder="Inchargename">
                        </div>

                        <div class="col-md-2">
                            <label>Age</label>
                            <input type="number" class="form-control" id="Age" name="Age" placeholder="age">
                        </div>

                        <div class="col-md-6">
                            <label>Father Name</label>
                            <input type="text" class="form-control" id="FatherName" name="FatherName" placeholder="Enter father's full name">
                        </div>

                        <div class="col-md-6">
                            <label for="categorySelect" class="form-label">Category</label>
                            <select id="categorySelect" class="form-select" name="CasteId">
                                <option value="">-- Select Category --</option>
                                @foreach (var cat in ViewData["CategoryList"] as List<VishanSabha.Models.Caste>)
                                {
                                    <option value="@cat.Caste_Id">@cat.CasteName</option>
                                }
                            </select>
                        </div>


                        <!-- Sub Caste -->
                        <div class="col-md-6">
                            <label for="subCasteSelect" class="form-label"> Caste</label>
                            <select id="subCasteSelect" class="form-select" name="subcaste">
                                <option value="">--Select Caste--</option>

                            </select>


                        </div>



                        <div class="col-md-6">
                            <label>Education Level</label>
                            <input type="text" class="form-control" id="Education" name="Education" placeholder="Enter highest education (e.g., B.A., 12th)">
                        </div>

                        <div class="col-md-6">
                            <label>Phone Number</label>
                            <input type="tel" class="form-control" id="PhoneNumber" name="PhoneNumber" placeholder="Enter 10-digit mobile number">
                        </div>

                        <div class="col-md-6">
                            <label for="address">Address</label>
                            <textarea id="Address" class="form-control" name="Address" placeholder="Enter full address with landmark"></textarea>
                        </div>

                        <div class="col-md-6">
                            <label for="Image">Profile Image</label>
                            <input type="file" id="ProfileImage" class="form-control" name="Image">
                        </div>

                    </div>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-outline-orange">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

<script defer src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
    document.getElementById('createSectorModal').addEventListener('hidden.bs.modal', function () {
        const form = document.getElementById('mysectorform');
        form.reset();

        // Clear hidden fields
        document.getElementById('Id').value = '';


        const villageField = document.getElementById('Village');
        if (villageField) {
            villageField.value = '';

            $(villageField).val('').trigger('change');
        }

        // Reset submit button text
        $("#mysectorform button[type=submit]").text("Save");
    });
</script>



<script>


    $(document).ready(function () {
        $('.js-example-basic-multiple').select2();
    });
</script>


@*bind mondal in selecter*@
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch('/Admin/GetMandals') // Adjust path if needed
            .then(response => response.json())
            .then(data => {
                const dropdown = document.getElementById("mandalDropdown");
                dropdown.innerHTML = '<option disabled selected>Select Mandal</option>';

                data.forEach(mandal => {
                    const option = document.createElement("option");
                    option.value = mandal.Id;
                    option.textContent = mandal.Name;
                    dropdown.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Failed to load mandals:", error);
                const dropdown = document.getElementById("mandalDropdown");
                dropdown.innerHTML = '<option disabled selected>Error loading mandals</option>';
            });
    });
</script>

@*bind mondal in selecter*@
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch('/Admin/GetMandals') // Adjust path if needed
            .then(response => response.json())
            .then(data => {
                const dropdown = document.getElementById("mandalDropdown");
                dropdown.innerHTML = '<option disabled selected>Select Mandal</option>';

                data.forEach(mandal => {
                    const option = document.createElement("option");
                    option.value = mandal.Id;
                    option.textContent = mandal.Name;
                    dropdown.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Failed to load mandals:", error);
                const dropdown = document.getElementById("mandalDropdown");
                dropdown.innerHTML = '<option disabled selected>Error loading mandals</option>';
            });
    });
</script>



@*this script use to form open and close click yas or no*@
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const inchargeSelect = document.querySelector(".modal-incharge-select");
        const additionalFields = document.querySelector(".modal-additional");

        inchargeSelect.addEventListener("change", function () {
            if (inchargeSelect.value === "1") {
                additionalFields.classList.remove("d-none");
            } else {
                additionalFields.classList.add("d-none");
            }
        });
    });
</script>



@*this script use to select cast then open subcasts*@
<script>
    $(document).ready(function () {
        $('#categorySelect').change(function () {
            var selectedOption = $(this).find('option:selected');
            var categoryId = selectedOption.val();
            var categoryName = selectedOption.text();

            $('#CasteName').val(categoryName);
            $('#subCasteSelect').empty().append('<option value="">-- Loading --</option>');
            $('#subcaste').val(''); // Reset hidden subcaste

            if (categoryId) {
                $.ajax({
                    url: '@Url.Action("GetSubcastesByCategory", "Admin")',
                    type: 'GET',
                    data: { categoryId: categoryId },
                    success: function (data) {
                        $('#subCasteSelect').empty().append('<option value="">-- Select Caste --</option>');
                        $.each(data, function (i, item) {
                            $('#subCasteSelect').append('<option value="' + item.SubCaste_Id + '">' + item.SubCasteName + '</option>');
                        });

                        $(document).trigger('subcasteLoaded');
                    },
                    error: function () {
                        $('#subCasteSelect').empty().append('<option value="">-- Error Loading --</option>');
                    }
                });
            } else {
                $('#subCasteSelect').empty().append('<option value="">-- Select Caste --</option>');
            }
        });


    });
</script>



<!-- DataTables Init -->




<script>
    $(document).on("click", ".delete-btn", function () {
        var id = $(this).data("id");

        if (!id) {
            Swal.fire("Error!", "No ID found for deletion.", "error");
            return;
        }

        Swal.fire({
            title: "Are you sure?",
            text: "This record will be permanently deleted!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '/Admin/DeleteSector',
                    type: 'POST',
                    data: { Id: id },
                    success: function (response) {
                        if (response.success) {
                            Swal.fire("Deleted!", response.message, "success").then(() => {
                                $("#row_" + id).fadeOut(500, function () {
                                    $(this).remove();
                                });
                            });
                        } else {
                            Swal.fire("Error!", response.message, "error");
                        }
                    },
                    error: function (xhr, status, error) {
                        Swal.fire("Error!", "Something went wrong while deleting.", "error");
                    }
                });
            }
        });
    });
</script>
<script>
    // Function to populate villages based on mandalId, and optionally preselect
    function populateVillages(mandalId, selectedVillageArray = []) {
        let villageDropdown = $("#Village");
        villageDropdown.html('<option disabled >Loading villages...</option>');

        $.ajax({
            url: '/admin/GetVillageListByMandalId',
            type: 'GET',
            data: { mandalId: mandalId },
            success: function (response) {
                villageDropdown.empty();

                if (response && response.length > 0) {
                    villageDropdown.append('<option disabled >-- Select Village --</option>');
                    $.each(response, function (index, village) {
                        villageDropdown.append('<option value="' + village.villageId + '">' + village.Villagename + '</option>');
                    });

                    // Bind selected villages if provided
                    if (selectedVillageArray.length > 0) {
                        $('#Village').val(selectedVillageArray).trigger('change');
                    }
                } else {
                    villageDropdown.append('<option disabled >No villages found</option>');
                }
            },
            error: function (xhr, status) {
                villageDropdown.html('<option disabled >Error loading villages</option>');
                console.error("Error fetching villages:", xhr, status);
            }
        });
    }

    // Mandal dropdown change – normal case
    $(document).on('change', '#mandalDropdown', function () {
        populateVillages($(this).val());
    });

    // Edit button click
    $(document).on("click", ".edit-btn", function () {
        const id = $(this).data("id");

        $.ajax({
            url: '/Admin/EditSector',
            type: 'GET',
            data: { Id: id },
            success: function (response) {
                if (!response) {
                    Swal.fire("Error!", "No data found for this Sector.", "error");
                    return;
                }

                $("#Id").val(response.Id);
                $("#SectorName").val(response.SectorName);
                $("#SectorInchargeDropdown").val(response.SectorInchargeName).trigger('change');
                $("#mandalDropdown").val(response.Mandal_Id);
                // Prepare village array safely
                let villageArray = [];
                if (response.villageId) {
                    if (typeof response.villageId === "string") {
                        villageArray = response.villageId.split(',').map(v => v.trim());
                    } else if (Array.isArray(response.villageId)) {
                        villageArray = response.villageId.map(v => v.toString());
                    } else {
                        villageArray = [response.villageId.toString()];
                    }
                }

                // Populate villages and bind selected values
                populateVillages(response.Mandal_Id, villageArray);

                if (response.SectorInchargeName == 1) {
                    $('.modal-additional').removeClass('d-none');
                    $("#InchargeName").val(response.InchargeName);
                    $("#FatherName").val(response.FatherName);
                    $("#Age").val(response.Age);
                    $("#Education").val(response.Education);
                    $("#PhoneNumber").val(response.PhoneNumber);
                    $("#Address").val(response.Address);
                    $('#categorySelect').val(response.CasteId).trigger('change');

                    // When the subcaste dropdown is populated after category change
                    // Wait for subcastes to finish binding
                    $(document).one('subcasteLoaded', function () {
                        console.log('Subcastes loaded, setting subcaste value...');
                        $('#subCasteSelect').val(response.subCasteId).trigger('change');
                    });

                    //$('#categorySelect').val(response.castename).trigger('change');
                    //setTimeout(() => {
                    //    $('#subCasteSelect').val(response.subcaste);
                    //}, 500);

                    if (response.ProfileImage) {
                        $("#profilePreview").attr("src", response.ProfileImage).show();
                    } else {
                        $("#profilePreview").hide();
                    }
                } else {
                    $('.modal-additional').addClass('d-none');
                }

                $("#createSectorModal .modal-title").text("Edit Sector");
                $("#mysectorform button[type=submit]").text("Update");
                $("#createSectorModal").modal("show");
            },
            error: function () {
                Swal.fire("Error!", "Error while fetching data.", "error");
            }
        });
    });




</script>

<script>
    $(document).ready(function () {
        // 🔄 Submit form
        $('#mysectorform').on('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);

            let selectedVillages = $('#Village').val();
            if (selectedVillages && selectedVillages.length > 0) {
                formData.set('Village', selectedVillages.join(','));
            }

            $.ajax({
                type: 'POST',
                url: '/Admin/addSectors',
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    Swal.fire({
                        icon: response.success ? 'success' : 'error',
                        title: response.success ? (response.status === 'insert' ? 'Sector Created' : 'Sector Updated') : 'Error',
                        text: response.message || 'An error occurred.'
                    }).then(() => {
                        if (response.success) {
                            $('#createSectorModal').modal('hide');
                            location.reload();
                        }
                    });
                },
                error: function () {
                    Swal.fire("Error!", "Saving failed.", "error");
                }
            });
        });

        // 🔁 Show/hide Inchargefields
        $('#SectorInchargeDropdown').on('change', function () {
            $(this).val() === "1"
                ? $('.modal-additional').removeClass('d-none')
                : $('.modal-additional').addClass('d-none');
        });

        // 🟩 Load subcastes when caste is changed
        //$('#categorySelect').on('change', function () {
        //    const casteId = $(this).val();
        //    const casteName = $(this).find("option:selected").text();
        //    $('#CasteName').val(casteName);
        //    $('#subcaste').val('');
        //    loadSubcastes(casteId, null);
        //});

        // 🔁 Update hidden subcaste on change
        $('#subCasteSelect').on('change', function () {
            $('#subcaste').val($(this).find("option:selected").text());
        });
    });

    // 🟡 Edit Button Click
    //$(document).on("click", ".edit-btn", function () {
    //    const id = $(this).data("id");

    //    $.ajax({
    //        url: '/Admin/EditSector',
    //        type: 'GET',
    //        data: { Id: id },
    //        success: function (response) {
    //            if (!response) {
    //                Swal.fire("Error!", "No data found for this Sector.", "error");
    //                return;
    //            }


    //            $("#Id").val(response.Id);
    //            $('#mandalDropdown').val(response.Mandal_Id).trigger('change');


    //            setTimeout(() => {
    //                if (response.villageId) {

    //                    const villageArray = response.villageId.split(',').map(v => v.trim());


    //                    $('#Village').val(villageArray).trigger('change');
    //                }
    //            }, 500);
    //            $("#SectorName").val(response.SectorName);
    //            $("#SectorInchargeDropdown").val(response.SectorInchargeName).trigger('change');

    //            if (response.SectorInchargeName == 1) {
    //                $('.modal-additional').removeClass('d-none');
    //                $("#InchargeName").val(response.InchargeName);
    //                $("#FatherName").val(response.FatherName);
    //                $("#Age").val(response.Age);
    //                $("#Education").val(response.Education);
    //                $("#PhoneNumber").val(response.PhoneNumber);
    //                $("#Address").val(response.Address);

    //                $('#categorySelect').val(response.castename).trigger('change');


    //                setTimeout(() => {
    //                    $('#subCasteSelect').val(response.subcaste);
    //                }, 500);


    //                if (response.ProfileImage) {
    //                    $("#profilePreview").attr("src", response.ProfileImage).show();
    //                } else {
    //                    $("#profilePreview").hide();
    //                }
    //            } else {
    //                $('.modal-additional').addClass('d-none');
    //            }

    //            $("#createSectorModal .modal-title").text("Edit Sector");
    //            $("#mysectorform button[type=submit]").text("Update");
    //            $("#createSectorModal").modal("show");
    //        },
    //        error: function () {
    //            Swal.fire("Error!", "Error while fetching data.", "error");
    //        }
    //    });
    //});

    // ✅ Load Subcastes Function
    function loadSubcastes(casteId, selectedSubCaste) {
        if (casteId) {
            $.ajax({
                url: '/Admin/GetSubcastesByCategory',
                type: 'GET',
                data: { categoryId: casteId },
                success: function (data) {
                    $('#subCasteSelect').empty().append('<option value="">-- Select Sub Caste --</option>');

                    let found = false;

                    $.each(data, function (i, item) {
                        let isSelected = (item.SubCasteName === selectedSubCaste);
                        if (isSelected) found = true;

                        $('#subCasteSelect').append(
                            `<option value="${item.SubCasteName}" ${isSelected ? 'selected' : ''}>${item.SubCasteName}</option>`
                        );
                    });

                    // Set hidden field
                    if (found) {
                        $('#subcaste').val(selectedSubCaste);
                    } else {
                        $('#subcaste').val('');
                    }
                },
                error: function () {
                    $('#subCasteSelect').empty().append('<option value="">-- Error Loading --</option>');
                }
            });
        }
    }
</script>
<script>
    $(document).ready(function () {

        let dt;
        let currentPage = 1;
        let limit = 100;

        initDataTable(limit);

        function initDataTable(limit) {

            dt = new DataTable('#myTable', {
                paging: true,
                pageLength: limit,
                lengthMenu: [100, 200, 300, 400, 500],
                searching: true,
                scrollX: true,
                scrollY: 350,
                autoWidth: false,   // 🚫 DataTables auto width ko disable karega
                columnDefs: [
                    { width: "50px", targets: 0 },    // S.N.
                    { width: "136px", targets: 1 },   // Mandal Name
                    { width: "136px", targets: 2 },
                    { width: "136px", targets: 3 },
                    { width: "136px", targets: 4 },
                    { width: "136px", targets: 5 },
                    { width: "136px", targets: 6 },
                    { width: "136px", targets: 7 }
                ]
            });

            // 🔥 Single-click pagination event
            dt.on('page.dt', function () {

                limit = getLimit();
                currentPage = dt.page() + 1;  // DataTable page is zero-based

                console.log("Page:", currentPage, "Limit:", limit);

                loadBackend(currentPage, limit);
            });
        }

        function getLimit() {
            return parseInt($(".dt-length select").val()) || 100;
        }

        // When user changes page size
        $(document).on("change", ".dt-length select", function () {

            limit = getLimit();
            currentPage = 1;  // Reset to page 1

            console.log("Limit changed to:", limit);

            loadBackend(currentPage, limit);
        });

        function loadBackend(page, limit) {

            console.log("Calling backend with page:", page, "limit:", limit);

            $.ajax({
                url: `/Admin/Sector?page=${page}&limit=${limit}`,
                type: "GET",
                success: function (html) {

                    $("#tableContainer").html(html);
                    reinitialize(limit);
                },
                error: function (xhr, status, error) {
                    console.error("AJAX error:", error);
                }
            });
        }

        function reinitialize(limit) {

            if ($.fn.DataTable.isDataTable('#myTable')) {
                $('#myTable').DataTable().destroy();
            }

            initDataTable(limit);
        }

    });
</script>

@*<script>
        $(document).ready(function () {

            let currentPage = 1;

            // Initialize DataTable
            const table = new DataTable('#myTable', {
                scrollX: true,
                scrollY: 360,
                paging: true,
                autoWidth: false,
                pageLength: 100,
                lengthMenu: [100, 200, 300, 400, 500],

            });
            // Function to get current selected limit value
            function getCurrentLimit() {
                return parseInt($('#myTable_length select').val()) || 100;
            }


            // ✅ NEXT button
            $('#myTable_next').click(function () {
                //alert("urhlkjnkn");
                currentPage++;
                const limit = getCurrentLimit();
                loadTableData(currentPage, limit);
            });

            // ✅ PREVIOUS button
            $('#myTable_previous').click(function () {
                if (currentPage > 1) {
                    currentPage--;
                    const limit = getCurrentLimit();
                    loadTableData(currentPage, limit);
                }
            });


            // Function to load table data via AJAX
            function loadTableData(page, limit) {
                fetch(`/Admin/Sector?page=${page}&limit=${limit}`, {
                    method: 'GET'
                })
                    .catch(error => console.error('Error calling Admin Controller:', error));
            }

            // ✅ Customize DataTables layout (after render)
            setTimeout(function () {
                const lengthDiv = $('.dataTables_length');
                const filterDiv = $('.dataTables_filter');

                // Capitalize 'entries' → 'Entries'
                const label = lengthDiv.find('label');
                label.html(function (i, oldHtml) {
                    return oldHtml.replace(/entries/i, 'Entries');
                });

                // Styling
                label.css({
                    'font-weight': '500',
                    'font-size': '13px',
                    'color': '#333'
                });

                // Move dropdown & search box
                $('#entriesAndExport').html(lengthDiv);
                $('#searchBox').html(filterDiv);

                // Layout
                $('.table-controls').css({
                    'display': 'flex',
                    'justify-content': 'space-between',
                    'align-items': 'center',
                    'gap': '10px'
                });

            }, 200);

        });
    </script>*@

@*<script>
        $(document).ready(function () {
            debugger
            var page = 1;
            var limit; // default limit

            // Initialize DataTable
            var table = $('#myTable').DataTable({
                lengthMenu: [[100, 200, 300, 400, -1], [100, 200, 300, 400, "All"]],
                pageLength: limit
            });

            limit = table.data().count();

            // Update 'limit' whenever user changes "Show entries"
            $('#myTable_length select').on('change', function () {
                var selectedVal = $(this).val();
                if (!selectedVal || selectedVal === "-1") {
                    limit = 100; // fallback if "All" or empty
                } else {
                    limit = parseInt(selectedVal);
                }
                console.log('Updated limit:', limit); // for testing
            });

            // Next button click
            $('#myTable_next').on('click', function () {
                page++;
                alert(`Next clicked!\nPage: ${page}\nLimit: ${limit}`);
                callAdminController(page, limit);
            });

            // Previous button click
            $('#myTable_previous').on('click', function () {
                if (page > 1) {
                    page--;
                    alert(`Previous clicked!\nPage: ${page}\nLimit: ${limit}`);
                    callAdminController(page, limit);
                }
            });

            // Function to call Admin Controller
            function callAdminController(page, limit) {
                fetch(`/Admin/Sector?page=${page}&limit=${limit}`, {
                    method: 'GET'
                })
                    .catch(error => console.error('Error calling Admin Controller:', error));
            }
        });
    </script>*@










